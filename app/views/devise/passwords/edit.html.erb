<%#
  Password Reset Form View
  URL: /password/reset/:token
  
  Displays the password reset form for artists to set a new password.
  Matches wireframe specifications from requirements/wireframes/auth/password-reset.md
  
  Features:
  - New password input with strength indicator
  - Password confirmation input
  - Password visibility toggles
  - Password requirements checklist
  - Error message display
%>

<div class="auth-page-container">
  <div class="auth-form-container">
    <div class="auth-form-header">
      <h1 class="auth-form-title">Create New Password</h1>
      <p class="auth-form-subtitle">Enter your new password below</p>
    </div>

    <% if resource.errors[:reset_password_token].any? || resource.errors[:base].any? || (resource.persisted? && resource.reset_password_token.blank?) %>
      <div class="auth-form-field">
        <% error_msg = resource.errors[:reset_password_token].first || resource.errors[:base].first || "This password reset link is invalid or has expired. Please request a new one." %>
        <%= error_message(error_msg, field_id: 'reset_token') %>
      </div>
    <% end %>

    <% token = resource.reset_password_token.presence || params[:reset_password_token] %>
    <%= form_for(resource, as: resource_name, url: password_reset_edit_path(token), html: { method: :patch, class: "auth-form" }) do |f| %>
      <%= f.hidden_field :reset_password_token %>

      <div class="auth-form-field" data-controller="password-strength password-toggle">
        <%= f.label :password, "New Password", class: "auth-form-label" %>
        <div class="auth-form-input-wrapper">
          <%= f.password_field :password, 
              autofocus: true,
              autocomplete: "new-password",
              placeholder: "Create a password",
              class: "auth-form-input auth-form-input-password",
              data: { 
                password_strength_target: "input",
                password_toggle_target: "input",
                action: "input->password-strength#updateStrength keyup->password-strength#updateStrength"
              },
              aria: { required: true } %>
          <button type="button" 
                  class="auth-form-password-toggle"
                  data-action="click->password-toggle#toggle"
                  data-password-toggle-target="button"
                  aria-label="Toggle password visibility">
            <span data-password-toggle-target="icon">ğŸ‘ï¸</span>
          </button>
        </div>

        <!-- Password Strength Indicator -->
        <div class="password-strength-indicator">
          <div class="password-strength-bar-container">
            <div class="password-strength-bar" data-password-strength-target="strengthBar"></div>
          </div>
          <div class="password-strength-text">
            Password Strength: <span data-password-strength-target="strengthLevel">-</span>
          </div>
        </div>

        <!-- Password Requirements -->
        <ul class="password-requirements" data-password-strength-target="requirements">
          <li class="password-requirement-item" data-requirement="length">
            <span class="requirement-icon requirement-unmet">âœ—</span>
            <span class="requirement-text requirement-unmet">8-30 characters</span>
          </li>
          <li class="password-requirement-item" data-requirement="case">
            <span class="requirement-icon requirement-unmet">âœ—</span>
            <span class="requirement-text requirement-unmet">Uppercase and lowercase letters</span>
          </li>
          <li class="password-requirement-item" data-requirement="number">
            <span class="requirement-icon requirement-unmet">âœ—</span>
            <span class="requirement-text requirement-unmet">At least one number</span>
          </li>
          <li class="password-requirement-item" data-requirement="special">
            <span class="requirement-icon requirement-unmet">âœ—</span>
            <span class="requirement-text requirement-unmet">At least one special character</span>
          </li>
        </ul>

        <% if resource.errors[:password].any? %>
          <%= error_message(resource.errors[:password].first, field_id: 'password') %>
        <% end %>
      </div>

      <div class="auth-form-field" data-controller="password-toggle">
        <%= f.label :password_confirmation, "Confirm New Password", class: "auth-form-label" %>
        <div class="auth-form-input-wrapper">
          <%= f.password_field :password_confirmation, 
              autocomplete: "new-password",
              placeholder: "Confirm your password",
              class: "auth-form-input auth-form-input-password",
              data: { password_toggle_target: "input" },
              aria: { required: true } %>
          <button type="button" 
                  class="auth-form-password-toggle"
                  data-action="click->password-toggle#toggle"
                  data-password-toggle-target="button"
                  aria-label="Toggle password visibility">
            <span data-password-toggle-target="icon">ğŸ‘ï¸</span>
          </button>
        </div>
        <% if resource.errors[:password_confirmation].any? %>
          <%= error_message(resource.errors[:password_confirmation].first, field_id: 'password_confirmation') %>
        <% end %>
      </div>

      <div class="auth-form-actions">
        <%= f.submit "Reset Password", class: "auth-form-submit" %>
      </div>
    <% end %>
  </div>
</div>
