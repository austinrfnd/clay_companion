# frozen_string_literal: true

FactoryBot.define do
  factory :studio_image do
    artist
    
    # Active Storage attachment (create test image file if needed)
    after(:build) do |studio_image|
      # Create test image file if it doesn't exist
      FileUtils.mkdir_p('spec/fixtures/files')
      unless File.exist?('spec/fixtures/files/test_image.jpg')
        jpeg_data = [0xFF, 0xD8, 0xFF, 0xE0, 0x00, 0x10, 0x4A, 0x46, 0x49, 0x46, 0x00, 0x01, 0x01, 0x01, 0x00, 0x48, 0x00, 0x48, 0x00, 0x00, 0xFF, 0xDB, 0x00, 0x43, 0x00, 0x08, 0x06, 0x06, 0x07, 0x06, 0x05, 0x08, 0x07, 0x07, 0x07, 0x09, 0x09, 0x08, 0x0A, 0x0C, 0x14, 0x0D, 0x0C, 0x0B, 0x0B, 0x0C, 0x19, 0x12, 0x13, 0x0F, 0x14, 0x1D, 0x1A, 0x1F, 0x1E, 0x1D, 0x1A, 0x1C, 0x1C, 0x20, 0x24, 0x2E, 0x27, 0x20, 0x22, 0x2C, 0x23, 0x1C, 0x1C, 0x28, 0x37, 0x29, 0x2C, 0x30, 0x31, 0x34, 0x34, 0x34, 0x1F, 0x27, 0x39, 0x3D, 0x38, 0x32, 0x3C, 0x2E, 0x33, 0x34, 0x32, 0xFF, 0xC0, 0x00, 0x11, 0x08, 0x00, 0x01, 0x00, 0x01, 0x03, 0x01, 0x22, 0x00, 0x02, 0x11, 0x01, 0x03, 0x11, 0x01, 0xFF, 0xC4, 0x00, 0x14, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0xFF, 0xC4, 0x00, 0x14, 0x10, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xDA, 0x00, 0x08, 0x01, 0x01, 0x00, 0x00, 0x3F, 0x00, 0xAA, 0xFF, 0xD9].pack('C*')
        File.binwrite('spec/fixtures/files/test_image.jpg', jpeg_data)
      end
      
      # Attach test image
      studio_image.image.attach(
        io: File.open(Rails.root.join('spec', 'fixtures', 'files', 'test_image.jpg')),
        filename: 'test_image.jpg',
        content_type: 'image/jpeg'
      )
    end
    
    alt_text { "View of ceramic studio workspace" }
    caption { "Working on a new series of minimalist vessels in my Portland studio." }
    width { 1920 }
    height { 1080 }
    file_size { 655_360 } # 640 KB
    display_order { 0 }

    trait :minimal do
      alt_text { nil }
      caption { nil }
      width { nil }
      height { nil }
      file_size { nil }
      # Don't attach image for minimal trait
      after(:build) do |studio_image|
        # Skip image attachment for minimal
      end
    end

    trait :with_long_caption do
      caption { "A" * 1000 }
    end

    trait :high_resolution do
      width { 4000 }
      height { 3000 }
      file_size { 2_621_440 } # 2.5 MB
    end
  end
end
